ALIGN 16
SECTION .text
global _start

%define SYS_WRITE       1
%define SYS_EXIT_GROUP  231

%define LIST_LEN        1000

%define PART2           1

_start:
%ifdef PART2
    ; Part2: precompute left list element appearances in right list
    mov     rsi, LIST_LEN
    
.L0:
    mov     ebx, DWORD[list0 + rsi*4-4]
    mov     rdi, LIST_LEN
    xor     r8d, r8d
    
.L1:
    cmp     ebx, DWORD[list1 + rdi*4-4]
    setz    al
    add     r8b, al
    dec     rdi
    jnz     .L1
    
    mov     DWORD[counts + rsi*4-4], r8d
    dec     rsi
    jnz     .L0
%else
    ; Part1: sort both input lists in decreasing order
    lea     rcx, list0
    mov     rdx, LIST_LEN
    call    sort
    
    lea     rcx, list1
    mov     rdx, LIST_LEN
    call    sort
%endif
    
    ; calculate the score for input data
    xor     rcx, rcx
    xor     rdi, rdi
    
.L2:
    cmp     rcx, LIST_LEN
    jge     .DONE
    
    ; calc difference of a list item pair
    mov     eax, DWORD[list0 + rcx*4]
    
%ifdef PART2
    ; Part2: score calculation: list0[i] * list1.count(list0[i])
    mul     DWORD[counts + rcx*4]
%else
    ; Part1: score calculation: abs(list0[i] - list1[i])
    mov     edx, DWORD[list1 + rcx*4]
    sub     eax, edx
    
    ; calc absolute value of difference to get distance
    cdq
    xor     eax, edx
    sub     eax, edx
%endif
    
    add     edi, eax
    inc     rcx
    jmp     .L2
    
.DONE:
    call    print_u32
    
    ; exit with error code 0
    xor     rdi, rdi
    mov     eax, SYS_EXIT_GROUP
    syscall

; =============================================================================
; sort(int* array, int size)
; =============================================================================
sort:
    push    rbp
    mov     rbp, rsp
    sub     rsp, 12
    
    ; save parameters on stack
    mov     [rbp], rcx
    mov     [rbp-8], rdx

.L0:
    ; load array pointer and number of elements
    mov     rsi, [rbp]
    mov     rcx, [rbp-8]

.L1:
    mov     eax, DWORD[rsi]
    mov     ebx, DWORD[rsi+4]
    cmp     eax, ebx
    jl      .SKIP
    
    ; swap both elements if needed
    mov     DWORD[rsi], ebx
    mov     DWORD[rsi+4], eax
    
.SKIP:
    lea     rsi, [rsi+4]
    dec     rcx
    cmp     rcx, 1
    ja      .L1
    
    dec     rdx
    ja      .L0
    
    mov     rsp, rbp
    pop     rbp
    ret

; =============================================================================
; print_u32(uint32 number)
; =============================================================================
print_u32:
    ; allocate 16 byte on stack for printing
    mov     rsi, rsp
    sub     rsp, 16
    
    mov     eax, edi
    mov     ecx, 10

.L0:
    xor     edx, edx
    div     ecx
    lea     edx, [edx+'0']
    
    dec     rsi
    mov     [rsi], dl
    
    test    eax, eax
    jnz     .L0
    
    mov     rax, SYS_WRITE
    mov     rdi, 1
    lea     rdx, [rsp+16]
    sub     rdx, rsi
    syscall

    ; cleanup stack
    add     rsp, 16
    ret

SECTION .data

counts times 1000 dd 0

list0 dd 63343, 98209, 84541, 44413, 22440, 95042, 69434, 96178, 89783, 65775, 86545, 46651, 99338, 33222, 58577, 60478, 39698, 65226, 43676, 32152, 63686, 68183, 59626, 72213, 69756, 99901, 34754, 69920, 90232, 99343, 30403, 81128, 71770, 84748, 83319, 16660, 77290, 79793, 51397, 54288, 39301, 15346, 25788, 36723, 56814, 47590, 20602, 99803, 15499, 62268, 85794, 69492, 16660, 94756, 16660, 77911, 16911, 27192, 69368, 16852, 63474, 86545, 14040, 58936, 42875, 33787, 43007, 33044, 33020, 58953, 71779, 37855, 44413, 33097, 65775, 12043, 65011, 58936, 73771, 75263, 40144, 46651, 82666, 68710, 42030, 41887, 66749, 10759, 17588, 65785, 32822, 10671, 33787, 61585, 86677, 34669, 82748, 15919, 96178, 39195, 75263, 97137, 98209, 86545, 82221, 31680, 77212, 71947, 88874, 15893, 15499, 22506, 43676, 65775, 27456, 43676, 96178, 83319, 15099, 83628, 28949, 15320, 62844, 94756, 78110, 71843, 50003, 83319, 84973, 97137, 58936, 71077, 51397, 31580, 70574, 91230, 47962, 62092, 69230, 43676, 81128, 95485, 80445, 51648, 82950, 94033, 43676, 10573, 44413, 90107, 80341, 16066, 96086, 76671, 76136, 15499, 65775, 77212, 29953, 90054, 94756, 10470, 81128, 15499, 34853, 24071, 51397, 18881, 58690, 44338, 15499, 26678, 14024, 86545, 16660, 17794, 47000, 44413, 63493, 62268, 58936, 31131, 78110, 86516, 93231, 58936, 36675, 78110, 44473, 67378, 86545, 36723, 71355, 52609, 42937, 78110, 94756, 59217, 10605, 86545, 86545, 31914, 75151, 78110, 95575, 46024, 44413, 93619, 89448, 47590, 38714, 55404, 65775, 75308, 70078, 84512, 11398, 71691, 47992, 80252, 63054, 97845, 51633, 56796, 54493, 78110, 85023, 63420, 60621, 26035, 82029, 43676, 17802, 86545, 52247, 18538, 98474, 62268, 40947, 83944, 45922, 65458, 50197, 33788, 13744, 86043, 51397, 97022, 39670, 21616, 69962, 46651, 65775, 94756, 97582, 52076, 57704, 51397, 58840, 62284, 60129, 83319, 39021, 52720, 86545, 56735, 48223, 75263, 42421, 75263, 75043, 26790, 39888, 65775, 22157, 47033, 26469, 58936, 65775, 47590, 12789, 86967, 93561, 82666, 53152, 51397, 63580, 46248, 83150, 56877, 81128, 80671, 58936, 30843, 11107, 33787, 41883, 88519, 26411, 15214, 31131, 53943, 20072, 32606, 93116, 82666, 85274, 66304, 25703, 82087, 16035, 46651, 15775, 25691, 86545, 52366, 57806, 70700, 82666, 13915, 68975, 64780, 93231, 32347, 82998, 47590, 81455, 15499, 96178, 91213, 15752, 67234, 59510, 73415, 49323, 95736, 48723, 94756, 96229, 97137, 29503, 24905, 82666, 85585, 73819, 81018, 69309, 67505, 58936, 82666, 65775, 83118, 66474, 47428, 54877, 83319, 96178, 82666, 25942, 23575, 75135, 90530, 83319, 47590, 68349, 64681, 35360, 31098, 69116, 31433, 25809, 44054, 84748, 86545, 77212, 16406, 15400, 67976, 57521, 38333, 36299, 65775, 86545, 98399, 77212, 71149, 85822, 93951, 90428, 18069, 58936, 44413, 94311, 78875, 60474, 99820, 81128, 38529, 52573, 58936, 13961, 24493, 81128, 28571, 10225, 82452, 86545, 31313, 13207, 73214, 81342, 65775, 37220, 49204, 53561, 65493, 71555, 64319, 49581, 79607, 44382, 78110, 44570, 51736, 81128, 66424, 82666, 91300, 11138, 75493, 81128, 93132, 65809, 86545, 84748, 22750, 35768, 75874, 91593, 30523, 51397, 78110, 84035, 74404, 30968, 31719, 41786, 85504, 93207, 31131, 83100, 86545, 68239, 80074, 40950, 96178, 93460, 51622, 54328, 98209, 54835, 17337, 45562, 83519, 92714, 83089, 46303, 47329, 28184, 88224, 97215, 84428, 48130, 15499, 44103, 86108, 81924, 93231, 47816, 44413, 91465, 34269, 35048, 58120, 90143, 83319, 46651, 87849, 96178, 96178, 62370, 29548, 39436, 62854, 84748, 81674, 44413, 95171, 92615, 38291, 93044, 77212, 58936, 40887, 16660, 44413, 11840, 36429, 54199, 17281, 79577, 58936, 92055, 94756, 58936, 73911, 89669, 94756, 51397, 65016, 42381, 45602, 44587, 44461, 76437, 46651, 52123, 24331, 22177, 65775, 84266, 67988, 71149, 64219, 64088, 57333, 22484, 77514, 23617, 93880, 44413, 85985, 17063, 15499, 57907, 45074, 53662, 31131, 52394, 91020, 10077, 92012, 81782, 43179, 68422, 54313, 96178, 43676, 79195, 26319, 69409, 54308, 44086, 45910, 52487, 81128, 51397, 40038, 54195, 12679, 94621, 56205, 77870, 69865, 39180, 21522, 11165, 85476, 95829, 39512, 56835, 77212, 36723, 51199, 47590, 41001, 11266, 24707, 66290, 34912, 78110, 52705, 15541, 82666, 71149, 70352, 91638, 87532, 85803, 71074, 46651, 40619, 71149, 85393, 69012, 35643, 86545, 84682, 59407, 20816, 58936, 26119, 37733, 15499, 31664, 98957, 33324, 15499, 25493, 86494, 51653, 41106, 96797, 94721, 91509, 51458, 72833, 63182, 79623, 88188, 71149, 17064, 71465, 12008, 58318, 78663, 23440, 46651, 12527, 96178, 45987, 43676, 43676, 72213, 58936, 38918, 17588, 46651, 42051, 21742, 48556, 34333, 90524, 62864, 82666, 80050, 65775, 51397, 16358, 99706, 31885, 77212, 93454, 75521, 36180, 43676, 58936, 51397, 84700, 98209, 36723, 96178, 62268, 38826, 99043, 31131, 77212, 15499, 39106, 66201, 97137, 41721, 86233, 64847, 97749, 44413, 69675, 42497, 24086, 95939, 64142, 58936, 53614, 57234, 97137, 99439, 58102, 89352, 83319, 15499, 31229, 46651, 40668, 86629, 71628, 40846, 20397, 41118, 11366, 57937, 33787, 92772, 77212, 81128, 97137, 17588, 42052, 27806, 13760, 77212, 84748, 91121, 44830, 97137, 79257, 64393, 53398, 17099, 13089, 18687, 86545, 70385, 63170, 71024, 82413, 63222, 98209, 19344, 14882, 90152, 66877, 35794, 57101, 43676, 32513, 12929, 43676, 51397, 37848, 77408, 41390, 92716, 71149, 78110, 86308, 83319, 39043, 91837, 91515, 72526, 32320, 53321, 81516, 31131, 19663, 43676, 90850, 61111, 42621, 44413, 93231, 16304, 82666, 78110, 47590, 78110, 15499, 77350, 15499, 65024, 81128, 51397, 97112, 22355, 43676, 51397, 65775, 22445, 67760, 34895, 96369, 17237, 12327, 92743, 82465, 57620, 81128, 43217, 51397, 67838, 65775, 93819, 74424, 90048, 67049, 78110, 77956, 61361, 44413, 34105, 72068, 75738, 31131, 29960, 96116, 77059, 79362, 35325, 59877, 55619, 23825, 86872, 33461, 41646, 39006, 43478, 78110, 15499, 94756, 91161, 15499, 88916, 44413, 44413, 93856, 77212, 42058, 32695, 77048, 33487, 85570, 56360, 86914, 81927, 21499, 28296, 22467, 44413, 75581, 73319, 84796, 55625, 44413, 99602, 47529, 74769, 96178, 13264, 54979, 19401, 43676, 60980, 16660, 72268, 14779, 71077, 97137, 75263, 65302, 31131, 59555, 84748, 65186, 36723, 91525, 17103, 72306, 86803, 51830, 85444, 61242, 98854, 50418, 13040, 79381, 23120, 99140, 19555, 46049, 64971, 59315, 49777, 15575, 46570, 15057, 73249, 31131, 58936, 92333, 93231, 58936, 88577, 88541, 74087, 87061, 56483, 62016, 16300, 43676, 67689, 10504, 74316, 82666, 31557, 41209, 25384, 58936, 25473, 25169, 54797, 97408, 68168, 83319, 15499, 11173, 37393, 35203, 43246, 51397, 43240, 78110, 48302, 43676, 96098, 81128, 30312, 71712, 73470, 77212, 47590, 83224, 34788, 43702, 94505, 41455, 55855, 42309, 79923, 86545, 54142, 78110, 10679, 70963, 74238, 65520, 27102, 48012, 51794, 81810, 78110, 55575, 69499, 96178, 35360, 85378, 64013, 38589, 88979, 96178, 12601, 16660, 78110, 10988, 58139, 32116, 82666, 44413, 17561, 86390, 15499, 74982, 31131, 19498, 58879, 91669, 23296, 10252, 19600, 62538, 75263, 39169, 86743, 27160, 97272, 46651, 78110, 98477, 55088, 92869, 11171
list1 dd 84283, 35360, 17841, 22035, 43645, 45290, 47251, 39300, 19278, 85842, 35833, 83505, 84748, 89475, 42161, 44380, 71528, 70514, 44413, 33787, 90737, 37294, 75263, 60662, 84705, 21217, 72906, 93885, 95413, 15097, 51861, 86779, 89053, 91473, 42848, 75389, 79784, 93069, 47264, 27695, 92063, 39085, 51201, 17981, 32685, 98625, 69815, 93402, 72880, 97907, 76481, 44842, 80295, 97958, 89545, 73090, 72433, 85972, 10582, 22334, 43360, 79393, 42302, 61177, 49655, 72005, 58727, 37514, 99443, 52137, 49038, 94756, 62268, 27702, 98521, 61583, 22777, 18614, 38328, 15249, 33863, 46651, 61084, 39251, 22781, 53976, 35530, 25493, 20353, 84109, 83893, 30896, 97083, 73752, 67790, 79260, 65897, 44296, 21934, 77571, 56142, 57117, 23301, 73163, 91882, 95331, 59289, 15754, 46398, 10667, 69601, 11225, 98793, 97146, 86898, 50178, 19563, 37236, 48110, 87813, 45147, 18308, 83455, 31167, 57734, 28433, 17114, 30689, 32142, 75022, 37954, 87682, 75831, 15774, 97448, 11672, 65732, 42222, 80590, 58007, 51361, 77212, 97079, 14347, 60311, 91345, 98757, 17921, 66116, 51094, 67373, 79628, 69987, 27839, 18904, 87664, 34757, 59509, 36746, 49422, 15204, 76707, 57263, 24221, 66460, 26979, 50113, 27576, 10024, 94266, 53098, 49708, 45448, 71075, 70967, 79261, 10368, 52272, 99474, 62001, 13025, 44750, 53413, 29540, 67424, 19550, 47390, 26625, 53218, 96391, 99990, 15308, 65730, 65789, 87805, 29236, 31771, 18987, 64300, 78147, 48116, 92646, 65185, 19530, 52051, 85748, 79421, 80422, 29790, 55576, 49121, 72333, 65315, 90550, 31131, 24074, 25162, 75109, 43749, 75832, 65214, 39525, 63454, 51736, 35556, 21880, 65295, 92624, 40519, 17223, 58997, 96291, 18878, 83923, 39873, 11656, 70458, 84033, 39535, 32254, 61992, 29791, 54348, 19270, 85744, 96599, 30579, 45856, 50586, 23436, 60158, 60361, 78825, 10426, 96035, 15499, 20954, 22388, 81163, 91634, 32022, 91628, 62766, 69120, 90633, 10409, 12777, 34714, 79836, 10520, 62340, 39720, 46519, 61520, 33304, 36117, 70466, 64757, 21216, 18545, 93089, 93798, 82130, 25802, 84789, 40909, 71607, 58121, 96176, 57256, 45369, 14089, 62274, 93696, 87893, 70203, 64881, 25012, 61533, 42375, 71157, 83004, 91731, 80380, 84931, 84992, 18938, 53302, 54031, 53733, 70053, 94922, 51039, 95907, 48755, 71863, 26925, 78898, 42515, 73641, 76761, 81003, 78110, 43324, 21609, 82606, 81882, 33483, 94856, 83072, 95776, 49704, 38311, 18526, 34486, 86291, 48231, 58843, 39909, 48028, 56310, 99185, 17336, 92522, 13402, 32705, 48232, 57780, 81213, 98451, 99334, 20346, 23437, 10188, 36257, 56471, 16660, 67004, 42043, 73986, 22940, 14788, 17351, 93467, 45821, 50930, 97634, 43212, 74266, 54839, 21639, 46195, 51737, 42702, 33691, 27068, 82599, 39389, 20089, 43676, 40624, 69489, 57102, 85599, 28855, 61910, 72866, 89253, 92040, 79472, 86424, 37352, 85210, 89903, 80026, 88961, 38159, 35620, 93003, 48646, 44325, 82076, 74069, 18067, 99684, 21031, 90638, 57199, 82205, 71149, 58191, 47303, 36022, 72656, 55308, 19095, 46635, 15506, 40226, 25646, 44326, 74259, 83125, 85377, 49474, 77096, 32334, 88697, 13865, 48113, 15017, 61694, 27654, 79058, 32035, 20212, 51434, 89681, 38356, 40535, 35913, 20493, 65172, 20026, 74410, 63206, 39064, 57312, 42601, 56746, 13866, 56073, 89828, 43617, 68234, 17714, 91242, 61907, 45542, 56287, 33780, 81704, 95069, 54245, 10776, 15551, 47590, 71220, 20160, 93991, 59450, 71333, 42520, 54366, 31338, 94941, 13396, 74187, 10131, 34774, 36723, 45677, 13499, 15009, 84895, 74165, 18259, 98209, 80104, 69709, 68814, 97541, 73729, 72978, 58000, 63119, 40369, 90150, 52608, 71077, 31624, 38760, 91176, 63143, 91823, 34818, 59892, 17484, 30905, 32038, 36181, 61442, 52676, 84219, 66449, 22863, 23017, 79892, 82803, 83319, 30234, 73499, 46440, 95631, 81128, 74448, 14447, 32611, 57781, 64820, 68420, 47754, 34335, 29717, 89191, 82795, 16549, 82556, 99163, 18471, 56195, 89300, 46990, 81806, 38774, 75955, 56634, 14693, 53016, 73961, 62726, 73112, 95820, 89033, 18786, 37161, 65250, 37464, 86725, 85011, 67737, 98362, 34884, 32918, 44619, 80495, 55837, 60689, 44176, 39854, 13045, 40466, 97137, 19527, 88017, 31622, 79812, 55320, 99675, 10226, 58609, 92126, 85290, 79783, 93581, 90551, 40558, 39089, 32385, 16747, 20505, 70730, 48459, 66724, 26340, 11972, 85523, 76588, 15882, 84892, 17238, 72970, 63431, 90427, 57232, 64933, 56557, 89980, 39968, 22733, 64872, 58936, 75725, 28054, 72081, 25950, 35455, 61813, 41704, 79271, 23953, 46535, 63102, 30834, 64012, 68305, 94295, 40622, 91004, 64037, 11981, 94012, 78178, 61342, 46974, 57688, 64308, 44044, 36812, 46898, 37454, 96884, 52528, 56661, 91311, 94931, 87647, 57203, 21346, 61629, 93631, 81359, 66314, 13411, 15431, 62759, 84813, 71791, 83838, 90129, 98160, 33794, 71088, 85754, 85337, 54712, 43618, 25861, 59485, 20950, 59143, 19018, 99973, 35822, 31306, 92941, 92804, 62182, 93200, 79238, 56028, 26131, 55412, 40092, 89193, 84584, 58395, 70934, 27303, 41447, 15725, 69760, 81266, 95326, 89236, 45408, 65803, 23823, 82448, 12317, 63704, 31591, 60656, 84397, 15943, 69553, 67670, 29623, 45656, 57563, 35401, 29524, 10799, 20503, 31145, 24662, 88787, 77284, 81111, 96401, 45881, 14096, 31716, 96178, 11460, 22663, 17066, 48248, 47906, 60675, 14382, 62222, 99668, 16029, 20810, 11971, 70446, 95100, 81776, 56409, 78955, 15972, 82762, 40585, 82715, 13035, 41208, 75405, 52968, 89777, 47910, 17844, 78842, 96933, 84401, 22335, 38772, 10235, 64002, 97099, 19165, 94851, 11044, 30088, 92285, 90624, 54999, 56563, 93006, 77028, 63496, 59288, 19260, 65456, 76020, 71510, 38373, 95329, 81785, 73967, 55970, 75253, 67687, 26178, 31644, 85675, 98065, 47206, 68588, 81859, 81781, 12100, 76959, 62721, 47728, 80148, 36073, 77828, 60402, 20533, 67535, 86024, 45988, 79733, 36916, 91726, 89614, 91991, 48407, 41683, 61197, 23055, 76099, 34782, 79495, 56038, 75701, 90211, 91105, 26571, 70643, 96461, 97211, 83364, 37258, 76258, 77897, 90589, 53899, 59814, 99348, 45978, 21550, 28503, 70361, 38176, 27681, 34616, 63530, 93477, 38551, 30281, 85761, 54185, 34284, 90875, 50159, 73017, 70427, 13241, 43718, 58491, 61676, 59141, 68941, 99683, 11312, 12988, 58625, 38011, 31122, 72187, 83040, 35538, 26926, 20473, 65791, 90431, 44240, 68127, 88606, 82666, 63367, 66772, 34590, 10183, 54013, 88038, 85275, 29557, 91185, 91026, 47846, 58439, 17800, 50614, 20747, 50825, 92963, 86545, 32892, 41415, 52966, 94229, 24717, 90893, 91788, 20609, 83204, 25338, 51397, 93636, 37898, 93231, 74840, 50972, 24441, 45678, 74739, 40860, 30257, 62026, 55422, 78640, 34047, 72688, 71214, 29061, 81733, 30705, 45282, 70052, 85605, 67848, 29579, 21750, 44657, 14712, 66229, 69289, 74346, 63305, 35229, 99323, 17588, 17774, 89787, 41204, 62131, 43849, 39529, 40983, 24893, 45386, 56318, 68530, 25873, 94040, 36153, 88010, 79130, 71226, 29354, 87872, 27909, 99432, 10868, 26181, 11684, 93130, 63372, 78345, 75999, 87508, 79511, 51818, 79942, 84855, 87913, 47101, 50727, 20430, 74052, 63972, 32279, 83960, 57325, 91674, 78735, 72213, 65775, 78046, 92992, 61673, 90012, 73742, 64602, 34277, 38771, 83906, 54798, 48992, 39017, 17400, 48587, 37271, 59764, 63559, 21472, 70180